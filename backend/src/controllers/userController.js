import pool from "../config/db.js";export const getAllUsers = async (req, res) => {  try {    const result = await pool.query(      `SELECT id, name, email, role, created_at        FROM users        ORDER BY created_at DESC`    );    res.json(result.rows);  } catch (err) {    console.error("GET ALL USERS ERROR:", err);    res.status(500).json({ error: "Failed to fetch users" });  }};export const getUsersByRole = async (req, res) => {  try {    const { role } = req.params;    if (!["user", "officer", "admin"].includes(role)) {      return res.status(400).json({ error: "Invalid role" });    }    const result = await pool.query(      `SELECT id, name, email, role, created_at        FROM users        WHERE role = $1       ORDER BY created_at DESC`,      [role]    );    res.json(result.rows);  } catch (err) {    console.error("GET USERS BY ROLE ERROR:", err);    res.status(500).json({ error: "Failed to fetch users" });  }};export const getUserById = async (req, res) => {  try {    const { id } = req.params;    const result = await pool.query(      `SELECT id, name, email, role, created_at        FROM users        WHERE id = $1`,      [id]    );    if (result.rows.length === 0) {      return res.status(404).json({ error: "User not found" });    }    res.json(result.rows[0]);  } catch (err) {    console.error("GET USER BY ID ERROR:", err);    res.status(500).json({ error: "Failed to fetch user" });  }};export const updateUser = async (req, res) => {  try {    const { id } = req.params;    const { name, email, role } = req.body;    if (role && !["user", "officer", "admin"].includes(role)) {      return res.status(400).json({ error: "Invalid role" });    }    const userCheck = await pool.query("SELECT id FROM users WHERE id = $1", [id]);    if (userCheck.rows.length === 0) {      return res.status(404).json({ error: "User not found" });    }    const updates = [];    const values = [];    let paramCount = 1;    if (name) {      updates.push(`name = $${paramCount}`);      values.push(name);      paramCount++;    }    if (email) {      updates.push(`email = $${paramCount}`);      values.push(email);      paramCount++;    }    if (role) {      updates.push(`role = $${paramCount}`);      values.push(role);      paramCount++;    }    if (updates.length === 0) {      return res.status(400).json({ error: "No fields to update" });    }    values.push(id);    const result = await pool.query(      `UPDATE users        SET ${updates.join(", ")}        WHERE id = $${paramCount}       RETURNING id, name, email, role, created_at`,      values    );    res.json({      message: "User updated successfully",      user: result.rows[0]    });  } catch (err) {    console.error("UPDATE USER ERROR:", err);    res.status(500).json({ error: "Failed to update user" });  }};export const deleteUser = async (req, res) => {  try {    const { id } = req.params;    if (req.user.id === parseInt(id)) {      return res.status(400).json({ error: "Cannot delete your own account" });    }    const result = await pool.query(      "DELETE FROM users WHERE id = $1 RETURNING id, name, email",      [id]    );    if (result.rows.length === 0) {      return res.status(404).json({ error: "User not found" });    }    res.json({      message: "User deleted successfully",      user: result.rows[0]    });  } catch (err) {    console.error("DELETE USER ERROR:", err);    res.status(500).json({ error: "Failed to delete user" });  }};export const searchUsers = async (req, res) => {  try {    const { query, role } = req.query;    let sqlQuery = `      SELECT id, name, email, role, created_at       FROM users       WHERE 1=1    `;    const values = [];    let paramCount = 1;    if (query) {      sqlQuery += ` AND (name ILIKE $${paramCount} OR email ILIKE $${paramCount})`;      values.push(`%${query}%`);      paramCount++;    }    if (role && ["user", "officer", "admin"].includes(role)) {      sqlQuery += ` AND role = $${paramCount}`;      values.push(role);      paramCount++;    }    sqlQuery += " ORDER BY created_at DESC";    const result = await pool.query(sqlQuery, values);    res.json(result.rows);  } catch (err) {    console.error("SEARCH USERS ERROR:", err);    res.status(500).json({ error: "Failed to search users" });  }};
